<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="kubernetes,k8s," />










<meta name="description" content="Kubectl上下文和配置123456789101112$ kubectl config view # 显示合并的 kubeconfig 设置。# 同时使用多个 kubeconfig 文件，并且查看合并的配置$ KUBECONFIG=~/.kube/config:~/.kube/kubconfig2 kubectl c">
<meta name="keywords" content="kubernetes,k8s">
<meta property="og:type" content="article">
<meta property="og:title" content="Kubernetesb系列-集群问题排查">
<meta property="og:url" content="http://jinweida.github.io/2018-04-02/Kubernetesb系列-集群问题排查.html">
<meta property="og:site_name" content="金声玉振">
<meta property="og:description" content="Kubectl上下文和配置123456789101112$ kubectl config view # 显示合并的 kubeconfig 设置。# 同时使用多个 kubeconfig 文件，并且查看合并的配置$ KUBECONFIG=~/.kube/config:~/.kube/kubconfig2 kubectl config view# 查看名称为 “e2e” 的用户的密码$ kubectl">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-04-05T07:35:21.080Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kubernetesb系列-集群问题排查">
<meta name="twitter:description" content="Kubectl上下文和配置123456789101112$ kubectl config view # 显示合并的 kubeconfig 设置。# 同时使用多个 kubeconfig 文件，并且查看合并的配置$ KUBECONFIG=~/.kube/config:~/.kube/kubconfig2 kubectl config view# 查看名称为 “e2e” 的用户的密码$ kubectl">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://jinweida.github.io/2018-04-02/Kubernetesb系列-集群问题排查.html"/>





  <title>Kubernetesb系列-集群问题排查 | 金声玉振</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">金声玉振</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jinweida.github.io/2018-04-02/Kubernetesb系列-集群问题排查.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大汗">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="金声玉振">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Kubernetesb系列-集群问题排查</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-02T21:19:16+07:00">
                2018-04-02
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2018-04-05T14:35:21+07:00">
                2018-04-05
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/kubernetes/" itemprop="url" rel="index">
                    <span itemprop="name">kubernetes</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018-04-02/Kubernetesb系列-集群问题排查.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018-04-02/Kubernetesb系列-集群问题排查.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="Kubectl上下文和配置"><a href="#Kubectl上下文和配置" class="headerlink" title="Kubectl上下文和配置"></a>Kubectl上下文和配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> kubectl config view # 显示合并的 kubeconfig 设置。</span><br><span class="line"><span class="meta">#</span> 同时使用多个 kubeconfig 文件，并且查看合并的配置</span><br><span class="line"><span class="meta">$</span> KUBECONFIG=~/.kube/config:~/.kube/kubconfig2 kubectl config view</span><br><span class="line"><span class="meta">#</span> 查看名称为 “e2e” 的用户的密码</span><br><span class="line"><span class="meta">$</span> kubectl config view -o jsonpath='&#123;.users[?(@.name == "e2e")].user.password&#125;'</span><br><span class="line"><span class="meta">$</span> kubectl config current-context              # 显示当前上下文</span><br><span class="line"><span class="meta">$</span> kubectl config use-context my-cluster-name  # 设置默认的上下文为 my-cluster-name</span><br><span class="line"><span class="meta">#</span> 在 kubeconf 中添加一个支持基本鉴权的新集群。</span><br><span class="line"><span class="meta">$</span> kubectl config set-credentials kubeuser/foo.kubernetes.com --username=kubeuser --password=kubepassword</span><br><span class="line"><span class="meta">#</span> 使用特定的用户名和命名空间设置上下文。</span><br><span class="line"><span class="meta">$</span> kubectl config set-context gce --user=cluster-admin --namespace=foo \</span><br><span class="line">  &amp;&amp; kubectl config use-context gce</span><br></pre></td></tr></table></figure>
<h3 id="查看、查找资源"><a href="#查看、查找资源" class="headerlink" title="查看、查找资源"></a>查看、查找资源</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 查看集群</span><br><span class="line"><span class="meta">$</span> kubectl cluster-info</span><br><span class="line"><span class="meta">#</span> 分页查看更具体的信息</span><br><span class="line"><span class="meta">$</span> kubectl cluster-info dump | more</span><br><span class="line"><span class="meta">#</span> 查看pods所在的运行节点</span><br><span class="line"><span class="meta">$</span> kubectl get pods -o wide --all-namespaces</span><br><span class="line"><span class="meta">#</span> 按selector名来查找pod</span><br><span class="line"><span class="meta">$</span> kubectl get pod --selector name=redis</span><br><span class="line"><span class="meta">#</span> 具有基本输出的 get 命令</span><br><span class="line"><span class="meta">$</span> kubectl get services                          # 列出命名空间下的所有 service</span><br><span class="line"><span class="meta">$</span> kubectl get pods --all-namespaces             # 列出所有命名空间下的 pod</span><br><span class="line"><span class="meta">$</span> kubectl get pods -o wide                      # 列出命名空间下所有 pod，带有更详细的信息</span><br><span class="line"><span class="meta">$</span> kubectl get deployment my-dep                 # 列出特定的 deployment</span><br><span class="line"><span class="meta">$</span> kubectl get pods --include-uninitialized      # 列出命名空间下所有的 pod，包括未初始化的对象</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 有详细输出的 describe 命令</span><br><span class="line"><span class="meta">$</span> kubectl describe nodes my-node</span><br><span class="line"><span class="meta">$</span> kubectl describe pods my-pod</span><br><span class="line"><span class="meta">$</span> kubectl get services --sort-by=.metadata.name # List Services Sorted by Name</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 根据重启次数排序，列出所有 pod</span><br><span class="line"><span class="meta">$</span> kubectl get pods --sort-by='.status.containerStatuses[0].restartCount'</span><br><span class="line"><span class="meta">#</span> 查询带有标签 app=cassandra 的所有 pod，获取它们的 version 标签值</span><br><span class="line"><span class="meta">$</span> kubectl get pods --selector=app=cassandra rc -o \</span><br><span class="line">  jsonpath='&#123;.items[*].metadata.labels.version&#125;'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 获取命名空间下所有运行中的 pod</span><br><span class="line"><span class="meta">$</span> kubectl get pods --field-selector=status.phase=Running</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 所有所有节点的 ExternalIP</span><br><span class="line"><span class="meta">$</span> kubectl get nodes -o jsonpath='&#123;.items[*].status.addresses[?(@.type=="ExternalIP")].address&#125;'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 列出输出特定 RC 的所有 pod 的名称</span><br><span class="line"><span class="meta">#</span> "jq" 命令对那些 jsonpath 看来太复杂的转换非常有用，可以在这找到：https://stedolan.github.io/jq/</span><br><span class="line"><span class="meta">$</span> sel=$&#123;$(kubectl get rc my-rc --output=json | jq -j '.spec.selector | to_entries | .[] | "\(.key)=\(.value),"')%?&#125;</span><br><span class="line"><span class="meta">$</span> echo $(kubectl get pods --selector=$sel --output=jsonpath=&#123;.items..metadata.name&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 检查那些节点已经 ready</span><br><span class="line"><span class="meta">$</span> JSONPATH='&#123;range .items[*]&#125;&#123;@.metadata.name&#125;:&#123;range @.status.conditions[*]&#125;&#123;@.type&#125;=&#123;@.status&#125;;&#123;end&#125;&#123;end&#125;' \</span><br><span class="line"> &amp;&amp; kubectl get nodes -o jsonpath="$JSONPATH" | grep "Ready=True"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 列出某个 pod 目前在用的所有 Secret</span><br><span class="line"><span class="meta">$</span> kubectl get pods -o json | jq '.items[].spec.containers[].env[]?.valueFrom.secretKeyRef.name' | grep -v null | sort | uniq</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 列出通过 timestamp 排序的所有 Event</span><br><span class="line"><span class="meta">$</span> kubectl get events --sort-by=.metadata.creationTimestamp</span><br></pre></td></tr></table></figure>
<h3 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> kubectl create -f ./my-manifest.yaml           # 创建资源</span><br><span class="line"><span class="meta">$</span> kubectl create -f ./my1.yaml -f ./my2.yaml     # 从多个文件创建资源</span><br><span class="line"><span class="meta">$</span> kubectl create -f ./dir                        # 通过目录下的所有清单文件创建资源</span><br><span class="line"><span class="meta">$</span> kubectl create -f https://git.io/vPieo         # 使用 url 获取清单创建资源</span><br><span class="line"><span class="meta">$</span> kubectl run nginx --image=nginx                # 开启一个 nginx 实例</span><br><span class="line"><span class="meta">$</span> kubectl explain pods,svc                       # 获取 pod 和服务清单的描述文档</span><br></pre></td></tr></table></figure>
<h3 id="更新资源"><a href="#更新资源" class="headerlink" title="更新资源"></a>更新资源</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 滚动更新 pod：frontend-v1</span><br><span class="line"><span class="meta">$</span> kubectl rolling-update frontend-v1 -f frontend-v2.json </span><br><span class="line"><span class="meta">#</span> 变更资源的名称并更新镜像          </span><br><span class="line"><span class="meta">$</span> kubectl rolling-update frontend-v1 frontend-v2 --image=image:v2 </span><br><span class="line"><span class="meta">#</span> 更新 pod 的镜像 </span><br><span class="line"><span class="meta">$</span> kubectl rolling-update frontend --image=image:v2 </span><br><span class="line"><span class="meta">#</span> 中止进行中的过程                </span><br><span class="line"><span class="meta">$</span> kubectl rolling-update frontend-v1 frontend-v2 --rollback</span><br><span class="line"><span class="meta">#</span> 根据传入标准输入的 JSON 替换一个 pod        </span><br><span class="line"><span class="meta">$</span> cat pod.json | kubectl replace -f -                             </span><br><span class="line"><span class="meta">#</span> 强制替换，先删除，然后再重建资源。会导致服务中断。</span><br><span class="line"><span class="meta">$</span> kubectl replace --force -f ./pod.json</span><br><span class="line"><span class="meta">#</span> 为副本控制器（rc）创建服务，它开放 80 端口，并连接到容器的 8080 端口</span><br><span class="line"><span class="meta">$</span> kubectl expose rc nginx --port=80 --target-port=8000</span><br><span class="line"><span class="meta">#</span> 更新单容器的 pod，将其镜像版本（tag）更新到 v4</span><br><span class="line"><span class="meta">$</span> kubectl get pod mypod -o yaml | sed 's/\(image: myimage\):.*$/\1:v4/' | kubectl replace -f -</span><br><span class="line"><span class="meta">#</span> 增加标签</span><br><span class="line"><span class="meta">$</span> kubectl label pods my-pod new-label=awesome </span><br><span class="line"><span class="meta">#</span> 增加注释                     </span><br><span class="line"><span class="meta">$</span> kubectl annotate pods my-pod icon-url=http://goo.gl/XXBTWq</span><br><span class="line"><span class="meta">#</span> 将名称为 foo 的 deployment 设置为自动扩缩容       </span><br><span class="line"><span class="meta">$</span> kubectl autoscale deployment foo --min=2 --max=10</span><br></pre></td></tr></table></figure>
<h3 id="修补资源"><a href="#修补资源" class="headerlink" title="修补资源"></a>修补资源</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 部分更新节点</span><br><span class="line"><span class="meta">$</span> kubectl patch node k8s-node-1 -p '&#123;"spec":&#123;"unschedulable":true&#125;&#125;' </span><br><span class="line"><span class="meta">#</span> 更新容器的镜像，spec.containers[*].name 是必需的，因为它们是一个合并键</span><br><span class="line"><span class="meta">$</span> kubectl patch pod valid-pod -p '&#123;"spec":&#123;"containers":[&#123;"name":"kubernetes-serve-hostname","image":"new image"&#125;]&#125;&#125;'</span><br><span class="line"><span class="meta">#</span> 使用带有数组位置信息的 json 修补程序更新容器镜像</span><br><span class="line"><span class="meta">$</span> kubectl patch pod valid-pod --type='json' -p='[&#123;"op": "replace", "path": "/spec/containers/0/image", "value":"new image"&#125;]'</span><br><span class="line"><span class="meta">#</span> 使用带有数组位置信息的 json 修补程序禁用 deployment 的 livenessProbe</span><br><span class="line"><span class="meta">$</span> kubectl patch deployment valid-deployment  --type json   -p='[&#123;"op": "remove", "path": "/spec/template/spec/containers/0/livenessProbe"&#125;]'</span><br><span class="line"><span class="meta">#</span> 增加新的元素到数组指定的位置中</span><br><span class="line"><span class="meta">$</span> kubectl patch sa default --type='json' -p='[&#123;"op": "add", "path": "/secrets/1", "value": &#123;"name": "whatever" &#125; &#125;]'</span><br></pre></td></tr></table></figure>
<h3 id="缩放资源"><a href="#缩放资源" class="headerlink" title="缩放资源"></a>缩放资源</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 缩放名称为 'foo' 的 replicaset，调整其副本数为 3</span><br><span class="line"><span class="meta">$</span> kubectl scale --replicas=3 rs/foo                                 </span><br><span class="line"><span class="meta">#</span> 缩放在 "foo.yaml" 中指定的资源，调整其副本数为 3</span><br><span class="line"><span class="meta">$</span> kubectl scale --replicas=3 -f foo.yaml                            </span><br><span class="line"><span class="meta">#</span> 如果名称为 mysql 的 deployment 目前规模为 2，将其规模调整为 3</span><br><span class="line"><span class="meta">$</span> kubectl scale --current-replicas=2 --replicas=3 deployment/mysql</span><br><span class="line"><span class="meta">#</span> 缩放多个副本控制器</span><br><span class="line"><span class="meta">$</span> kubectl scale --replicas=5 rc/foo rc/bar rc/baz</span><br></pre></td></tr></table></figure>
<h3 id="删除资源"><a href="#删除资源" class="headerlink" title="删除资源"></a>删除资源</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 使用 pod.json 中指定的类型和名称删除 pod</span><br><span class="line"><span class="meta">$</span> kubectl delete -f ./pod.json </span><br><span class="line"><span class="meta">#</span> 删除名称为 "baz" 和 "foo" 的 pod 和 service</span><br><span class="line"><span class="meta">$</span> kubectl delete pod,service baz foo  </span><br><span class="line"><span class="meta">#</span> 删除带有标签 name=myLabel 的 pod 和 service                                      </span><br><span class="line"><span class="meta">$</span> kubectl delete pods,services -l name=myLabel  </span><br><span class="line"><span class="meta">#</span> 删除带有标签 name=myLabel 的 pod 和 service，包括未初始化的对象                            </span><br><span class="line"><span class="meta">$</span> kubectl delete pods,services -l name=myLabel --include-uninitialized </span><br><span class="line"><span class="meta">#</span> 删除命名空间 my-ns 下所有的 pod 和 service，包括未初始化的对象     </span><br><span class="line"><span class="meta">$</span> kubectl -n my-ns delete po,svc --all </span><br><span class="line"><span class="meta">$</span> kubectl -n "kube-system" delete deployment tiller-deploy</span><br><span class="line"><span class="meta">$</span> kubectl -n "kube-system" delete service tiller-deploy</span><br></pre></td></tr></table></figure>
<h3 id="与运行中的-pod-交互"><a href="#与运行中的-pod-交互" class="headerlink" title="与运行中的 pod 交互"></a>与运行中的 pod 交互</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 转储 pod 日志到标准输出</span><br><span class="line"><span class="meta">$</span> kubectl logs my-pod  </span><br><span class="line"><span class="meta">#</span> 有多个容器的情况下，转储 pod 中容器的日志到标准输出                               </span><br><span class="line"><span class="meta">$</span> kubectl logs my-pod -c my-container</span><br><span class="line"><span class="meta">#</span> pod 日志流向标准输出                 </span><br><span class="line"><span class="meta">$</span> kubectl logs -f my-pod    </span><br><span class="line"><span class="meta">#</span> 有多个容器的情况下，pod 中容器的日志流到标准输出                          </span><br><span class="line"><span class="meta">$</span> kubectl logs -f my-pod -c my-container</span><br><span class="line"><span class="meta">#</span> 使用交互的 shell 运行 pod              </span><br><span class="line"><span class="meta">$</span> kubectl run -i --tty busybox --image=busybox -- sh </span><br><span class="line"><span class="meta">#</span> 关联到运行中的容器 </span><br><span class="line"><span class="meta">$</span> kubectl attach my-pod -i  </span><br><span class="line"><span class="meta">#</span> 在本地监听 5000 端口，然后转到 my-pod 的 6000 端口                          </span><br><span class="line"><span class="meta">$</span> kubectl port-forward my-pod 5000:6000 </span><br><span class="line"><span class="meta">#</span> 1 个容器的情况下，在已经存在的 pod 中运行命令              </span><br><span class="line"><span class="meta">$</span> kubectl exec my-pod -- ls /     </span><br><span class="line"><span class="meta">#</span> 多个容器的情况下，在已经存在的 pod 中运行命令                    </span><br><span class="line"><span class="meta">$</span> kubectl exec my-pod -c my-container -- ls / </span><br><span class="line"><span class="meta">#</span> 显示 pod 及其容器的度量        </span><br><span class="line"><span class="meta">$</span> kubectl top pod POD_NAME --containers</span><br></pre></td></tr></table></figure>
<h3 id="与-node-和集群交互"><a href="#与-node-和集群交互" class="headerlink" title="与 node 和集群交互"></a>与 node 和集群交互</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 标记节点 my-node 为不可调度</span><br><span class="line"><span class="meta">$</span> kubectl cordon my-node  </span><br><span class="line"><span class="meta">#</span> 准备维护时，排除节点 my-node                                              </span><br><span class="line"><span class="meta">$</span> kubectl drain my-node </span><br><span class="line"><span class="meta">#</span> 标记节点 my-node 为可调度                                                </span><br><span class="line"><span class="meta">$</span> kubectl uncordon my-node  </span><br><span class="line"><span class="meta">#</span> 显示给定节点的度量值                                            </span><br><span class="line"><span class="meta">$</span> kubectl top node my-node </span><br><span class="line"><span class="meta">#</span> 显示 master 和 service 的地址                                             </span><br><span class="line"><span class="meta">$</span> kubectl cluster-info  </span><br><span class="line"><span class="meta">#</span> 将集群的当前状态转储到标准输出                                                </span><br><span class="line"><span class="meta">$</span> kubectl cluster-info dump        </span><br><span class="line"><span class="meta">#</span> 将集群的当前状态转储到目录 /path/to/cluster-state </span><br><span class="line"><span class="meta">$</span> kubectl cluster-info dump --output-directory=/path/to/cluster-state</span><br><span class="line"><span class="meta">#</span> 如果带有该键和效果的污点已经存在，则将按指定的方式替换其值</span><br><span class="line"><span class="meta">$</span> kubectl taint nodes foo dedicated=special-user:NoSchedule</span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    
      <div>
        
          <ul class="post-copyright">
            <li class="post-copyright-author">
              <strong>本文作者：</strong>
              大汗
            </li>
            <li class="post-copyright-link">
              <strong>本文链接：</strong>
              <a href="/2018-04-02/Kubernetesb系列-集群问题排查.html" title="Kubernetesb系列-集群问题排查">http://jinweida.github.io/2018-04-02/Kubernetesb系列-集群问题排查.html</a>
            </li>
            <li class="post-copyright-license">
              <strong>版权声明： </strong>
              本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
            </li>
          </ul>
        
      </div>
      
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/img/wechat-qcode.jpg" alt="大汗 wechat" style="width: 200px; max-width: 100%;"/>
    <div>扫描关注公众号</div>
</div>

      </div>
      
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div></div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/img/give.jpg" alt="大汗 微信支付"/>
        <p>微信支付</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/kubernetes/" rel="tag"># kubernetes</a>
          
            <a href="/tags/k8s/" rel="tag"># k8s</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018-04-02/Kubernetesb系列-状态ContainerCreating.html" rel="next" title="Kubernetesb系列-状态ContainerCreating">
                <i class="fa fa-chevron-left"></i> Kubernetesb系列-状态ContainerCreating
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018-04-02/Kubernetesb系列-apiserver.html" rel="prev" title="Kubernetesb系列-apiserver">
                Kubernetesb系列-apiserver <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div class="ds-thread" data-thread-key="2018-04-02/Kubernetesb系列-集群问题排查.html"
           data-title="Kubernetesb系列-集群问题排查" data-url="http://jinweida.github.io/2018-04-02/Kubernetesb系列-集群问题排查.html">
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">大汗</p>
              <p class="site-description motion-element" itemprop="description">金声玉振</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">88</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">28</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/jinweida" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Kubectl上下文和配置"><span class="nav-number">1.</span> <span class="nav-text">Kubectl上下文和配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看、查找资源"><span class="nav-number">2.</span> <span class="nav-text">查看、查找资源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建对象"><span class="nav-number">3.</span> <span class="nav-text">创建对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#更新资源"><span class="nav-number">4.</span> <span class="nav-text">更新资源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修补资源"><span class="nav-number">5.</span> <span class="nav-text">修补资源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#缩放资源"><span class="nav-number">6.</span> <span class="nav-text">缩放资源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除资源"><span class="nav-number">7.</span> <span class="nav-text">删除资源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#与运行中的-pod-交互"><span class="nav-number">8.</span> <span class="nav-text">与运行中的 pod 交互</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#与-node-和集群交互"><span class="nav-number">9.</span> <span class="nav-text">与 node 和集群交互</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">大汗</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"your-duoshuo-shortname"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  


















  





  

  

  

  
  

  

  

  

</body>
</html>
